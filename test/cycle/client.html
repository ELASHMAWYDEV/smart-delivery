<html>

<head>
  <title>Client Cycle | Smart Delivery</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>


<body>


  <div class="jumbotron">
    <h1 class="display-3">Client Cycle</h1>
    <p class="lead">All client events & cycles are to be tested from here</p>
    <hr class="my-2">
  </div>
  <div class="container">
    <div class="row">
      <div class="form-group col-md-12 ">
        <label for="token">Token:</label>
        <div class="row">
          <textarea type="text" class="form-control col-md-2" name="token"
            placeholder="token">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiQ2xpZW50MzMwMzEzMjYxOCIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NpZCI6IjMiLCJqdGkiOiI1NDY4N2U5ZC05ZDgyLTQzYzAtYWQyOS05YmViYzgzODUzNjgiLCJleHAiOjE2MTYyNDIwNTcsImlzcyI6Imh0dHA6Ly9sb2NhbGhvc3Q6NDQzNzciLCJhdWQiOiJodHRwOi8vbG9jYWxob3N0OjQ0Mzc3In0.6EcBcKt18oiEFyGNlvCzK5l-5s29iqVuqZSuAHQzf1s</textarea>
          <textarea type="text" class="form-control col-md-2" name="token"
            placeholder="token">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiQ2xpZW50NDIxMjY5OTM5NiIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NpZCI6IjI2IiwianRpIjoiMjAxMjY2YzgtNGQwZC00ZWU3LTlkMmQtMzBjODE3ZmJjMDU3IiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjoiQ2xpZW50IiwiZXhwIjoxNjE3NzE3MzIyLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjQ0Mzc3IiwiYXVkIjoiaHR0cDovL2xvY2FsaG9zdDo0NDM3NyJ9.-QU1RvdQHe1INdg3TYblUG65qupX1ZTFmG70M2q1m18</textarea>
          <textarea type="text" class="form-control col-md-2" name="token"
            placeholder="token">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiQ2xpZW50MzE4NDY1MDA3MCIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NpZCI6IjI0IiwianRpIjoiNmYyMWQ5ZTMtMzk1Yy00MzU1LThlNDUtN2NhZDA1NTNmNGVkIiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjoiQ2xpZW50IiwiZXhwIjoxNjE3NjEwMzU1LCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjQ0Mzc3IiwiYXVkIjoiaHR0cDovL2xvY2FsaG9zdDo0NDM3NyJ9.vYmBSCu8lAX8Ax1Uml8AHPamFG61dl49QU1ZBu4REDc</textarea>
          <textarea type="text" class="form-control col-md-2" name="token"
            placeholder="token">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiQ2xpZW50NTg2NDUwMjgyOSIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NpZCI6IjI3IiwianRpIjoiN2MyNTMxZmUtNzFmNC00ODk4LTgyZjctZDg2MDNkZjExOTM2IiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjoiQ2xpZW50IiwiZXhwIjoxNjE3NzE3NDkxLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjQ0Mzc3IiwiYXVkIjoiaHR0cDovL2xvY2FsaG9zdDo0NDM3NyJ9.-PK1YD9WlSIJX_E8cctuT-QlxALTGuFXJipMQF_f37E</textarea>
          <textarea type="text" class="form-control col-md-2" name="token"
            placeholder="token">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiQ2xpZW50NDIxMjY5OTM5NiIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NpZCI6IjI2IiwianRpIjoiMjAxMjY2YzgtNGQwZC00ZWU3LTlkMmQtMzBjODE3ZmJjMDU3IiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjoiQ2xpZW50IiwiZXhwIjoxNjE3NzE3MzIyLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjQ0Mzc3IiwiYXVkIjoiaHR0cDovL2xvY2FsaG9zdDo0NDM3NyJ9.-QU1RvdQHe1INdg3TYblUG65qupX1ZTFmG70M2q1m18</textarea>
          <textarea type="text" class="form-control col-md-2" name="token"
            placeholder="token">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiQ2xpZW50MDA2ODk1OTgwNCIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NpZCI6IjI4IiwianRpIjoiNjJjMmFkYjEtNTcyNy00MjViLWFjNzUtZWYwZjFjZTNlMWE0IiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjoiQ2xpZW50IiwiZXhwIjoxNjE3ODcyNDU5LCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjQ0Mzk0IiwiYXVkIjoiaHR0cDovL2xvY2FsaG9zdDo0NDM5NCJ9.MUd5No6IGHvRBjeQNsEi8idTlWWymuC4Ir1R_7TK2O0</textarea>
        </div>
        <div class="row">
          <textarea type="text" class="form-control col-md-2" name="token"
            placeholder="token">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiQ2xpZW50OTM2NTg5NTAwNiIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NpZCI6IjI5IiwianRpIjoiZGVmZDI5MjEtY2ExMS00NmYyLWI3OWYtOTAyMWRiMzgyYmY0IiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjoiQ2xpZW50IiwiZXhwIjoxNjE3ODcyNTE2LCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjQ0Mzk0IiwiYXVkIjoiaHR0cDovL2xvY2FsaG9zdDo0NDM5NCJ9.v0zKMeo-wMO4D5R4Mx_gIhzQbtk4-WwSEoU2Wk8WmTA</textarea>
          <textarea type="text" class="form-control col-md-2" name="token"
            placeholder="token">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiQ2xpZW50MzYyMzk5MDEwNCIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NpZCI6IjMwIiwianRpIjoiYTlmMjViZjAtZGRmNC00N2MzLTk2ZjgtZmVjY2EyMmFjY2Y0IiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjoiQ2xpZW50IiwiZXhwIjoxNjE3ODcyNjMxLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjQ0Mzk0IiwiYXVkIjoiaHR0cDovL2xvY2FsaG9zdDo0NDM5NCJ9.YPT7Kc80czuoBkkwKQiexQST_PFVroHYjZaWHZBZaYc</textarea>
          <textarea type="text" class="form-control col-md-2" name="token"
            placeholder="token">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiQ2xpZW50NTYxODM1NzUwNyIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NpZCI6IjMxIiwianRpIjoiMTlmZjgyZWUtNzE5YS00YjJiLWEwNWMtZWFjZWQzZThhM2E1IiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjoiQ2xpZW50IiwiZXhwIjoxNjE3ODcyNzUyLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjQ0Mzk0IiwiYXVkIjoiaHR0cDovL2xvY2FsaG9zdDo0NDM5NCJ9.S5hjzeK_UgXLV46yRJYvBOVXtsk9V80XOBFZAe_aFU4</textarea>
          <textarea type="text" class="form-control col-md-2" name="token" placeholder="token"></textarea>
          <textarea type="text" class="form-control col-md-2" name="token" placeholder="token"></textarea>
          <textarea type="text" class="form-control col-md-2" name="token" placeholder="token"></textarea>
        </div>
      </div>
    </div>

    <p class="lead">
      <button class="btn btn-primary btn-lg" id="new-order-btn" role="button">NewOrderRequest</button>
      <input type="number" value="1" min="1" max="50" id="number-of-orders" />
    </p>
    <div class="">
      <p class="lead">Result</p>
      <pre class="text-white p-4 display-5" id="new-order-result"></pre>
    </div>
  </div>
  <div class="container">
    <div class="row">
      <div class="form-group col-md-6">
        <label for="orderId">Order Id:</label>
        <input type="text" class="form-control" name="orderId" id="orderId" placeholder="orderId">
      </div>
    </div>

    <p class="lead">
      <button class="btn btn-primary btn-lg" id="cancel-order-btn" role="button">CancelOrder</button>
    </p>
    <div class="">
      <p class="lead">Result</p>
      <pre class="text-white p-4 display-5" id="cancel-order-result"></pre>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.4/socket.io.js"> </script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <script>

    //Initialize Socket
    const socket = io.connect(window.location.origin, {
      reconnection: true,
      reconnectionDelay: 500,
      reconnectionAttempts: Infinity
    });

    socket.on("connect", () => console.log("connected"));
    socket.on("disconnect", () => console.log("disconnected"));

    let orderIdInput = document.querySelector("#orderId");
    let tokensInput = document.querySelectorAll("textarea[name='token']");
    let numberOfOrdersInput = document.querySelector("#number-of-orders");

    let orderId = +orderIdInput.value;
    let tokens = [];
    tokensInput.forEach(input => tokens.push(input.value))
    let numberOfOrders = numberOfOrdersInput.value;

    let orderObject = {

      "branchId": null,
      "receiverName": "Dev Loay",
      "receiverAddress": "Ismailia ElSheikh Zayed",
      "receivermobile": "0595489308",
      "isPaid": false,
      "storeCost": 50.25,
      "discount": 0,
      "tax": 5,
      "deliveryCost": 0,
      "receiverCollected": 70.50,
      "location": [
        31.320115,
        29.868935
      ],
      "isLocated": true,
      "locationUrl": null,
      "items": [
        {
          "name": "Fried one",
          "price": 20.25,
          "quantity": 1.25
        },
        {
          "name": "Fried two",
          "price": 20,
          "quantity": 2
        },
        {
          "name": "Fried three",
          "price": 10,
          "quantity": 1
        }
      ]
    }



    orderIdInput.oninput = (e) => orderId = +e.target.value;
    tokensInput.forEach((input, i) => input.oninput = (e) => tokens[i] = e.target.value)
    numberOfOrdersInput.oninput = (e) => {
      numberOfOrders = +e.target.value;

    }



    let newOrderBtn = document.querySelector("#new-order-btn");
    let cancelOrderBtn = document.querySelector("#cancel-order-btn");


    newOrderBtn.onclick = async () => {
      let resultContainer = document.querySelector("#new-order-result");
      resultContainer.innerHTML = "";


      const sendRequest = async (token) => {
        let response = await axios.post("https://b2b.logione.net/api/Trip/MultiOrders", {
          orders:
            Array.from({ length: numberOfOrders }).map(t => ({ ...orderObject, refrenceNumber: Math.random().toString(36).slice(2) }))
        }, {
          headers: {
            Authorization: `Bearer ${token}`
          }
        }
        );

        let data = await response.data;
        if (!data.status) {
          resultContainer.classList.add("bg-danger");
          resultContainer.classList.remove("bg-success");
        } else {
          resultContainer.classList.remove("bg-danger");
          resultContainer.classList.add("bg-success");

        }
        resultContainer.innerHTML += JSON.stringify(data, null, 2);
        resultContainer.innerHTML += "<hr>";
      }

      Promise.all(tokens.map(token => token && sendRequest(token)))
    }


    /****************************************************/
    cancelOrderBtn.onclick = async () => {
      let response = await axios.post(`https://b2b.logione.net/api/Trip/CancelOrder?orderId=${orderId}`,
        {}, {
        headers: {
          Authorization: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiRHJpdjkxMjYzNDE3MDIiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9zaWQiOiIxNyIsImp0aSI6ImUxNmU3MjljLWJiMzQtNDNjNC1hODQ0LWQ1MTNkZjYxM2M1NSIsImV4cCI6MTYxNjkzMjg0NSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo0NDM5NCIsImF1ZCI6Imh0dHA6Ly9sb2NhbGhvc3Q6NDQzOTQifQ.Hyk1DDVdrlTKtNWQZh62VKTBmlc7aGTP4vO4n7jFXIo"
        }
      }
      );

      let data = await response.data;
      console.log(data);

      let resultContainer = document.querySelector("#cancel-order-result");
      if (!data.status) {
        resultContainer.classList.add("bg-danger");
        resultContainer.classList.remove("bg-success");
      } else {
        resultContainer.classList.remove("bg-danger");
        resultContainer.classList.add("bg-success");

      }
      resultContainer.textContent = JSON.stringify(data, null, 2);
    }




  </script>
</body>

</html>