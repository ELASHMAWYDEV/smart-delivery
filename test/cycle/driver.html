<html>

<head>
  <title>Driver Cycle | Smart Delivery</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>


<body>


  <div class="jumbotron">
    <h1 class="display-3">Driver Cycle</h1>
    <p class="lead">All driver events & cycles are to be tested from here</p>
    <hr class="my-2">
  </div>
  <div class="container">

    <div class="row">
      <div class="form-group col-md-6">
        <label for="driverId">Driver Id:</label>
        <input type="text" class="form-control" name="driverId" value="1" id="driverId" placeholder="driverId">
      </div>

      <div class="form-group col-md-6">
        <label for="token">Token:</label>
        <textarea type="text" class="form-control" name="token" id="token"
          placeholder="token">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiRHJpMDA1MzIxMzQ2NyIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NpZCI6IjMiLCJqdGkiOiI2MmZiNDQ4OS00Y2EwLTQyZGUtYjllNS1lZTc5ZDg3MjZkMzgiLCJleHAiOjE2MTYzMTQ3MzcsImlzcyI6Imh0dHA6Ly9sb2NhbGhvc3Q6NDQzOTQiLCJhdWQiOiJodHRwOi8vbG9jYWxob3N0OjQ0Mzk0In0.pSPV_tvT3xG4UWfKMWdHzoOctCq22ltma9fOrxkacp8</textarea>
      </div>
    </div>
    <h1>Go Online & Offline</h1>
    <p class="lead">
      <button class="btn btn-primary btn-lg mr-4" id="go-online-btn" role="button">Go Online</button>
      <button class="btn btn-danger btn-lg" id="go-offline-btn" role="button">Go Offline</button>
    </p>
    <p class="lead">Result</p>
    <pre class="text-white p-4 display-5" id="go-online-result"></pre>
  </div>
  <div class="container">
    <h1>NewOrderRequest</h1>
    <p class="lead">Listen</p>
    <pre class="text-white p-4 display-5" id="new-order-listen"></pre>
  </div>
  <div class="container">
    <h1>CancelOrder</h1>
    <p class="lead">Listen</p>
    <pre class="text-white p-4 display-5" id="cancel-order-listen"></pre>
  </div>
  <div class="container">
    <div class="form-group col-md-6">
      <label for="orderId">Order Id:</label>
      <input type="text" class="form-control" name="orderId" value="1" id="orderId" placeholder="orderId">
    </div>
    <hr>
    <div>
      <p class="lead">
        <button class="btn btn-primary btn-lg" id="accept-order-btn" onclick="acceptOrder()"
          role="button">AcceptOrder</button>
      </p>
      <p class="lead">Result</p>
      <pre class="text-white p-4 display-5" id="accept-order-listen"></pre>
    </div>
    <div>
      <p class="lead">
        <button class="btn btn-primary btn-lg" id="accept-order-btn" onclick="rejectOrder()"
          role="button">RejectOrder</button>
      </p>
      <p class="lead">Result</p>
      <pre class="text-white p-4 display-5" id="accept-order-listen"></pre>
    </div>
    <div>
      <p class="lead">
        <button class="btn btn-primary btn-lg" id="accept-order-btn" onclick="ignoreOrder()"
          role="button">IgnoreOrder</button>
      </p>
      <p class="lead">Result</p>
      <pre class="text-white p-4 display-5" id="accept-order-listen"></pre>
    </div>
    <div>
      <p class="lead">
        <button class="btn btn-primary btn-lg" id="accept-order-btn" onclick="receiveOrder()"
          role="button">ReceiveOrder</button>
      </p>
      <p class="lead">Result</p>
      <pre class="text-white p-4 display-5" id="accept-order-listen"></pre>
    </div>
    <div>
      <p class="lead">
        <button class="btn btn-primary btn-lg" id="accept-order-btn" onclick="deliverOrder()"
          role="button">DeliverOrder</button>
      </p>
      <p class="lead">Result</p>
      <pre class="text-white p-4 display-5" id="accept-order-listen"></pre>
    </div>
  </div>

  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.4/socket.io.js"> </script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <script>

    let driverIdInput = document.querySelector("#driverId");
    let tokenInput = document.querySelector("#token");
    let orderIdInput = document.querySelector("#orderId");

    let driverId = driverIdInput.value;
    let token = tokenInput.value;
    let orderId = orderIdInput.value;

    driverIdInput.oninput = (e) => driverId = e.target.value;
    tokenInput.oninput = (e) => token = e.target.value;
    orderIdInput.oninput = (e) => orderId = e.target.value;


    //Initialize Socket
    const socket = io.connect('http://localhost:5000', {
      reconnection: true,
      reconnectionDelay: 500,
      reconnectionAttempts: Infinity
    });

    socket.on("connect", () => console.log("connected"));
    socket.on("disconnect", () => console.log("disconnected"));

    //Online & Offline
    let goOnlineBtn = document.querySelector("#go-online-btn");
    let goOfflineBtn = document.querySelector("#go-offline-btn");

    goOnlineBtn.onclick = () => goOnline(1);
    goOfflineBtn.onclick = () => goOnline(2);



    socket.emit("GoOnline", {
      token,
      driverId,
      status: 1
    });

    const goOnline = (status) => {
      socket.emit("GoOnline", {
        token,
        driverId,
        status
      });
    }


    const acceptOrder = (status) => {
      socket.emit("AcceptOrder", {
        token,
        driverId,
        orderId
      });
    }

    const ignoreOrder = (status) => {
      socket.emit("IgnoreOrder", {
        token,
        driverId,
        orderId
      });
    }

    const rejectOrder = (status) => {
      socket.emit("RejectOrder", {
        token,
        driverId,
        orderId
      });
    }

    const receiveOrder = (status) => {
      socket.emit("ReceiveOrder", {
        token,
        driverId,
        orderId
      });
    }

    const deliverOrder = (status) => {
      socket.emit("DeliverOrder", {
        token,
        driverId,
        orderId
      });
    }





    /*************************************************************/

    //Listen for GoOnline
    socket.on("GoOnline", data => {
      console.log(data);
      let resultContainer = document.querySelector("#go-online-result");
      if (!data.status) {
        resultContainer.classList.add("bg-danger");
        resultContainer.classList.remove("bg-success");
      } else {
        resultContainer.classList.remove("bg-danger");
        resultContainer.classList.add("bg-success");

      }
      resultContainer.textContent = JSON.stringify(data, null, 2);
    })

    //Listen for New orders
    socket.on("NewOrderRequest", data => {
      console.log(data);
      let resultContainer = document.querySelector("#new-order-listen");
      if (!data.status) {
        resultContainer.classList.add("bg-danger");
        resultContainer.classList.remove("bg-success");
      } else {
        resultContainer.classList.remove("bg-danger");
        resultContainer.classList.add("bg-success");

        document.querySelector("#orderId").value = data.order.master.orderId;
        orderId = data.order.master.orderId;
      }
      resultContainer.textContent = JSON.stringify(data, null, 2);
    })


    //Listen for Accept
    socket.on("AcceptOrder", data => {
      console.log(data);
      let resultContainer = document.querySelector("#accept-order-listen");
      if (!data.status) {
        resultContainer.classList.add("bg-danger");
        resultContainer.classList.remove("bg-success");
      } else {
        resultContainer.classList.remove("bg-danger");
        resultContainer.classList.add("bg-success");

      }
      resultContainer.textContent = JSON.stringify(data, null, 2);
    })



    //Listen for Reject
    socket.on("RejectOrder", data => {
      console.log(data);
      let resultContainer = document.querySelector("#reject-order-listen");
      if (!data.status) {
        resultContainer.classList.add("bg-danger");
        resultContainer.classList.remove("bg-success");
      } else {
        resultContainer.classList.remove("bg-danger");
        resultContainer.classList.add("bg-success");

      }
      resultContainer.textContent = JSON.stringify(data, null, 2);
    })


    //Listen for Ignore
    socket.on("IgnoreOrder", data => {
      console.log(data);
      let resultContainer = document.querySelector("#ignore-order-listen");
      if (!data.status) {
        resultContainer.classList.add("bg-danger");
        resultContainer.classList.remove("bg-success");
      } else {
        resultContainer.classList.remove("bg-danger");
        resultContainer.classList.add("bg-success");

      }
      resultContainer.textContent = JSON.stringify(data, null, 2);
    })


    //Listen for Receive
    socket.on("ReceiveOrder", data => {
      console.log(data);
      let resultContainer = document.querySelector("#receive-order-listen");
      if (!data.status) {
        resultContainer.classList.add("bg-danger");
        resultContainer.classList.remove("bg-success");
      } else {
        resultContainer.classList.remove("bg-danger");
        resultContainer.classList.add("bg-success");

      }
      resultContainer.textContent = JSON.stringify(data, null, 2);
    })


    //Listen for Deliver
    socket.on("DeliverOrder", data => {
      console.log(data);
      let resultContainer = document.querySelector("#deliver-order-listen");
      if (!data.status) {
        resultContainer.classList.add("bg-danger");
        resultContainer.classList.remove("bg-success");
      } else {
        resultContainer.classList.remove("bg-danger");
        resultContainer.classList.add("bg-success");

      }
      resultContainer.textContent = JSON.stringify(data, null, 2);
    })



    //Listen for Cancel
    socket.on("CancelOrder", data => {
      console.log(data);
      let resultContainer = document.querySelector("#cancel-order-listen");
      if (!data.status) {
        resultContainer.classList.add("bg-danger");
        resultContainer.classList.remove("bg-success");
      } else {
        resultContainer.classList.remove("bg-danger");
        resultContainer.classList.add("bg-success");

      }
      resultContainer.textContent = JSON.stringify(data, null, 2);
    })




  </script>
</body>

</html>